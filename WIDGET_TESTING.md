# Інструкція для тестування віджета Quest Timer

## Підготовка до тестування

1. **Збірка проекту**
   ```bash
   ./gradlew assembleDebug
   ```

2. **Встановлення на пристрій**
   ```bash
   ./gradlew installDebug
   ```

## Тестування основного функціоналу

### 1. Додавання віджета

1. Довге натискання на вільному місці домашнього екрану
2. Вибрати "Widgets" або "Віджети"
3. Знайти "Quest Timer Widget"
4. Перетягнути на домашній екран
5. **Очікуваний результат**: Віджет з'являється з текстом "--:--" або поточним значенням таймера

### 2. Перевірка оновлення в реальному часі

1. Запустити квест з віджета або головного застосунку
2. Спостерігати за оновленням таймера на віджеті
3. **Очікуваний результат**: Таймер оновлюється кожну секунду без затримок

### 3. Тестування кнопки Info

1. Під час активного квесту натиснути кнопку Info (ліва кнопка)
2. **Очікуваний результат**: Текст таймера показує загальний час з початку квесту, колір міняється на фіолетовий
3. Натиснути Info знову
4. **Очікуваний результат**: Повернення до режиму countdown

### 4. Тестування діалогу додавання часу

1. Під час активного квесту натиснути кнопку Add (права кнопка)
2. **Очікуваний результат**: Відкривається діалог з кнопками "5m", "10m", "15m", "Cancel"
3. Натиснути "10m"
4. **Очікуваний результат**: Діалог закривається, час до завершення квесту збільшується на 10 хвилин

### 5. Тестування діалогу вибору квесту

1. Під час break натиснути кнопку Add
2. **Очікуваний результат**: Відкривається діалог зі списком доступних квестів
3. Вибрати квест зі списку
4. **Очікуваний результат**: Діалог закривається, новий квест клонується і запускається

### 6. Тестування діалогу незапланованої перерви

1. Під час активного квесту натиснути на текст таймера (центр)
2. **Очікуваний результат**: Відкривається діалог з полем вводу причини
3. Ввести причину або вибрати зі списку
4. Натиснути "Start"
5. **Очікуваний результат**: Незапланована перерва починається, таймер стає сірим

### 7. Тестування завершення перерви з віджета

1. Під час break натиснути на текст таймера
2. **Очікуваний результат**: Перерва завершується достроково, режим змінюється на OVERTIME (break)

### 8. Тестування зупинки незапланованої перерви

1. Під час unplanned break натиснути на текст таймера
2. **Очікуваний результат**: Незапланована перерва зупиняється, відкривається діалог для причини (якщо була відкладена)

### 6. Перевірка різних режимів таймера

Переконатися, що віджет коректно відображає всі режими:

- **QUEST_COUNTDOWN**: Синій колір, таймер зменшується
- **OVERTIME**: Червоний колір, таймер зі знаком мінус
- **BREAK**: Зелений колір
- **UNPLANNED_BREAK**: Сірий колір
- **INFO**: Фіолетовий колір
- **UNLOCK**: Жовтий колір

### 7. Тестування стану кнопок

1. Під час UNPLANNED_BREAK кнопка Add має бути неактивною (напівпрозора)
2. Під час INFO режиму обидві бонки повинні реагувати коректно
3. У режимі INACTIVE кнопка Info має бути неактивною

## Перевірка продуктивності

1. Додати декілька віджетів (2-3) на різні екрани
2. Переконатися, що всі віджети оновлюються синхронно
3. Перевірити використання батареї протягом години активного використання

## Перевірка стабільності

1. **Перезапуск застосунку**: Віджет має продовжувати працювати
2. **Перезавантаження пристрою**: Після перезавантаження віджет має відновити стан
3. **Видалення віджета**: Сервіс `TimerWidgetUpdateService` має зупинитися при видаленні останнього віджета

## Налагодження

Для перегляду логів віджета використовуйте:

```bash
adb logcat | grep -E "TimerWidgetProvider|TimerWidgetUpdateSvc"
```

Основні лог-повідомлення:
- "Widget enabled, starting update service" - віджет додано
- "Widget disabled, stopping update service" - віджет видалено
- "Received update" - отримано оновлення стану
- "Timer state changed" - стан таймера змінився

## Відомі проблеми та їх вирішення

### Віджет не оновлюється

1. Перевірити, чи запущений TimerService:
   ```bash
   adb shell dumpsys activity services | grep TimerService
   ```

2. Перевірити, чи запущений TimerWidgetUpdateService:
   ```bash
   adb shell dumpsys activity services | grep TimerWidgetUpdateService
   ```

3. Перезапустити застосунок

### Кнопки не реагують

1. Перевірити логи на наявність crash'ів
2. Переконатися, що PendingIntent'и створюються з правильними флагами
3. Видалити і знову додати віджет

## Контрольний список

- [ ] Віджет додається без помилок
- [ ] Таймер оновлюється кожну секунду
- [ ] Всі кнопки реагують на кліки
- [ ] Кольори змінюються відповідно до режиму
- [ ] Декілька віджетів працюють синхронно
- [ ] Віджет працює після перезапуску застосунку
- [ ] Сервіс коректно запускається і зупиняється
- [ ] Немає витоків пам'яті або надмірного використання батареї
- [ ] Діалог додавання часу відкривається і працює коректно
- [ ] Діалог вибору квесту показує список і дозволяє вибрати квест
- [ ] Діалог незапланованої перерви дозволяє ввести причину
- [ ] Діалог відкладеної причини автоматично відкривається коли потрібно
- [ ] Всі діалоги відображаються поверх інших застосунків
- [ ] Діалоги не залишаються в recent apps
- [ ] Клік на таймер виконує правильну дію в кожному режимі
- [ ] Кнопка Add відкриває правильний діалог залежно від режиму
