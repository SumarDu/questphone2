# Quest List Widget - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

## –û–≥–ª—è–¥

–í—ñ–¥–∂–µ—Ç –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î —Å–ø–∏—Å–æ–∫ –∫–≤–µ—Å—Ç—ñ–≤ –∑ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –µ–∫—Ä–∞–Ω—É –¥–æ–¥–∞—Ç–∫–∞ —É –≤–∏–≥–ª—è–¥—ñ –ø–ª–∏—Ç–æ–∫. –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—ñ –∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é Grit –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Jetpack Glance.

## –°—Ç–≤–æ—Ä–µ–Ω—ñ —Ñ–∞–π–ª–∏

### 1. Kotlin –∫–æ–¥
- **`app/src/main/java/neth/iecal/questphone/widgets/QuestListWidget.kt`**
  - `QuestListWidgetReceiver` - –ø—Ä–∏–π–º–∞—á –æ–Ω–æ–≤–ª–µ–Ω—å –≤—ñ–¥–∂–µ—Ç—É
  - `QuestListWidgetRepository` - —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –∫–≤–µ—Å—Ç—ñ–≤ –∑ –ë–î
  - `QuestListWidget` - –æ—Å–Ω–æ–≤–Ω–∏–π –∫–ª–∞—Å –≤—ñ–¥–∂–µ—Ç—É –∑ UI

### 2. XML –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
- **`app/src/main/res/xml/quest_list_widget.xml`** - –±–∞–∑–æ–≤–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –≤—ñ–¥–∂–µ—Ç—É
- **`app/src/main/res/xml-v31/quest_list_widget.xml`** - –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –¥–ª—è Android 12+ (API 31+)
- **`app/src/main/res/layout/glance_default_loading_layout.xml`** - –µ–∫—Ä–∞–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

### 3. –†–µ—Å—É—Ä—Å–∏
- **`app/src/main/res/values/strings.xml`** - –¥–æ–¥–∞–Ω–æ –æ–ø–∏—Å –≤—ñ–¥–∂–µ—Ç—É
- **`app/src/main/res/drawable/quest_widget_preview.xml`** - –ø—Ä–µ–≤'—é –≤—ñ–¥–∂–µ—Ç—É

### 4. AndroidManifest.xml
–ó–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ `QuestListWidgetReceiver` –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –ø–æ–¥—ñ–π –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–∂–µ—Ç—É.

## –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª

### –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–≤–µ—Å—Ç—ñ–≤
- ‚úÖ –ü–æ–∫–∞–∑—É—î –∫–≤–µ—Å—Ç–∏ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ (Today)
- ‚úÖ –°–æ—Ä—Ç—É—î –∑–∞ —á–∞—Å–æ–º –ø–æ—á–∞—Ç–∫—É (all-day –∫–≤–µ—Å—Ç–∏ –≤ –∫—ñ–Ω—Ü—ñ)
- ‚úÖ –í—ñ–¥–æ–±—Ä–∞–∂–∞—î —Ç—ñ–ª—å–∫–∏ –∞–∫—Ç–∏–≤–Ω—ñ –∫–≤–µ—Å—Ç–∏ (–Ω–µ –∑–Ω–∏—â–µ–Ω—ñ)
- ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `SchedulingUtils` –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ –∫–≤–µ—Å—Ç–∞ –Ω–∞ –¥–∞—Ç—É

### –î–∏–∑–∞–π–Ω –ø–ª–∏—Ç–∫–∏
–ö–æ–∂–Ω–∞ –ø–ª–∏—Ç–∫–∞ –º—ñ—Å—Ç–∏—Ç—å:
- **–ö–æ–ª—å–æ—Ä–æ–≤–∞ —Å–º—É–∂–∫–∞ –∑–ª—ñ–≤–∞** - –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—É –∫–≤–µ—Å—Ç–∞:
  - üî¥ –ß–µ—Ä–≤–æ–Ω–∏–π - `IMPORTANT_URGENT`
  - üü¢ –ó–µ–ª–µ–Ω–∏–π - `IMPORTANT_NOT_URGENT`
  - üü° –ë–µ–∂–µ–≤–∏–π - `NOT_IMPORTANT_URGENT`
  - üîµ –°–∏–Ω—ñ–π - `STABLE`
  - ‚ö™ –°—ñ—Ä–∏–π - `NOT_IMPORTANT_NOT_URGENT`

- **–ù–∞–∑–≤–∞ –∫–≤–µ—Å—Ç–∞** - –∂–∏—Ä–Ω–∏–º —à—Ä–∏—Ñ—Ç–æ–º (–º–∞–∫—Å–∏–º—É–º 2 —Ä—è–¥–∫–∏)
- **–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å** - —É —Ñ–æ—Ä–º–∞—Ç—ñ "Xh Ym"
- **–ß–∞—Å–æ–≤—ñ –º—ñ—Ç–∫–∏** (—è–∫—â–æ —î):
  - –ß–∞—Å –ø–æ—á–∞—Ç–∫—É
  - –ß–∞—Å –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è
  - ‚è∞ –î–µ–¥–ª–∞–π–Ω (—á–µ—Ä–≤–æ–Ω–∏–º –∫–æ–ª—å–æ—Ä–æ–º)

### –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å
- –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤—ñ–¥–∂–µ—Ç—É –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –≥–æ–ª–æ–≤–Ω–∏–π –µ–∫—Ä–∞–Ω –¥–æ–¥–∞—Ç–∫–∞
- –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ –ø–ª–∏—Ç–∫—É –∫–≤–µ—Å—Ç–∞ –≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è –¥–æ–¥–∞—Ç–æ–∫
- –ö–Ω–æ–ø–∫–∞ "Open App" –≤–Ω–∏–∑—É —Å–ø–∏—Å–∫—É –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø—É

## –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

### –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
–î–æ–¥–∞–Ω–æ –≤ `build.gradle.kts`:
```kotlin
implementation("androidx.glance:glance-appwidget:1.1.0")
implementation("androidx.glance:glance-material3:1.1.0")
```

### –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–∂–µ—Ç—É
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ**: –∫–æ–∂–Ω—ñ 30 —Ö–≤–∏–ª–∏–Ω (`updatePeriodMillis="1800000"`)
- **–†—É—á–Ω–µ**: –º–æ–∂–Ω–∞ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –∑ –∫–æ–¥—É —á–µ—Ä–µ–∑ `GlanceAppWidgetManager`

### –†–æ–±–æ—Ç–∞ –∑ –ë–î
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î:
- `QuestDatabaseProvider.getInstance(context).questDao()`
- `Flow<List<CommonQuestInfo>>` –¥–ª—è —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö
- `collectAsState` –¥–ª—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó Flow –∑ Compose

### Glance vs Jetpack Compose
–í—ñ–¥–∂–µ—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **Glance** - —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è –≤—ñ–¥–∂–µ—Ç—ñ–≤:
- –°—Ö–æ–∂–∏–π API –¥–æ Jetpack Compose
- –û–±–º–µ–∂–µ–Ω–∏–π –Ω–∞–±—ñ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ (–±–µ–∑ –ø–æ–≤–Ω–æ—ó –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ Material3)
- –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π –¥–ª—è RemoteViews

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –≤—ñ–¥–∂–µ—Ç—É
1. –î–æ–≤–≥–∏–π –Ω–∞—Ç–∏—Å–∫ –Ω–∞ –≥–æ–ª–æ–≤–Ω–æ–º—É –µ–∫—Ä–∞–Ω—ñ –ª–∞—É–Ω—á–µ—Ä–∞
2. –í–∏–±—Ä–∞—Ç–∏ "Widgets" / "–í—ñ–¥–∂–µ—Ç–∏"
3. –ó–Ω–∞–π—Ç–∏ "QuestPhone" —Ç–∞ –≤–∏–±—Ä–∞—Ç–∏ "Today's Quest List Widget"
4. –ü–µ—Ä–µ—Ç—è–≥–Ω—É—Ç–∏ –Ω–∞ —Ä–æ–±–æ—á–∏–π —Å—Ç—ñ–ª

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ä–æ–∑–º—ñ—Ä—É
- –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π: 250dp √ó 180dp
- –ü—ñ–¥—Ç—Ä–∏–º—É—î –∑–º—ñ–Ω—É —Ä–æ–∑–º—ñ—Ä—É –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—ñ —Ç–∞ –≤–µ—Ä—Ç–∏–∫–∞–ª—ñ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∞–¥–∞–ø—Ç—É—î—Ç—å—Å—è –¥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç–æ—Ä—É

## –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è

### 1. –î–æ–¥–∞—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏
–ú–æ–∂–Ω–∞ —Ä–æ–∑—à–∏—Ä–∏—Ç–∏ –≤—ñ–¥–∂–µ—Ç –¥–ª—è –ø–æ–∫–∞–∑—É:
- –ö–≤–µ—Å—Ç—ñ–≤ –Ω–∞ –∑–∞–≤—Ç—Ä–∞
- –ö–≤–µ—Å—Ç—ñ–≤ –≤–∏—Ö—ñ–¥–Ω–∏—Ö
- –¢—ñ–ª—å–∫–∏ –≤–∞–∂–ª–∏–≤–∏—Ö –∫–≤–µ—Å—Ç—ñ–≤

### 2. –í–∑–∞—î–º–æ–¥—ñ—è –∑ –∫–≤–µ—Å—Ç–∞–º–∏
- –ü–æ–∑–Ω–∞—á–∏—Ç–∏ –∫–≤–µ—Å—Ç —è–∫ –≤–∏–∫–æ–Ω–∞–Ω–∏–π –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –∑ –≤—ñ–¥–∂–µ—Ç—É
- –ó–∞–ø—É—Å—Ç–∏—Ç–∏ —Ç–∞–π–º–µ—Ä –¥–ª—è –∫–≤–µ—Å—Ç–∞

### 3. –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
–°—Ç–≤–æ—Ä–∏—Ç–∏ `ConfigurationActivity` –¥–ª—è:
- –í–∏–±–æ—Ä—É —Ñ—ñ–ª—å—Ç—Ä–∞ (Today/Tomorrow/Weekend)
- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∫–æ–ª—å–æ—Ä—ñ–≤
- –í–∏–±–æ—Ä—É —Ä–æ–∑–º—ñ—Ä—É —Ç–µ–∫—Å—Ç—É

### 4. –ö—ñ–ª—å–∫–∞ —Ä–æ–∑–º—ñ—Ä—ñ–≤ –≤—ñ–¥–∂–µ—Ç—É
–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ä—ñ–∑–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏:
- –ö–æ–º–ø–∞–∫—Ç–Ω–∏–π (1√ó1) - –ø–æ–∫–∞–∑—É—î —Ç—ñ–ª—å–∫–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–≤–µ—Å—Ç—ñ–≤
- –°–µ—Ä–µ–¥–Ω—ñ–π (2√ó2) - –ø–æ–∫–∞–∑—É—î 3-4 –∫–≤–µ—Å—Ç–∏
- –í–µ–ª–∏–∫–∏–π (4√ó3) - –ø–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫

## –í—ñ–¥–æ–º—ñ –æ–±–º–µ–∂–µ–Ω–Ω—è

1. **–û–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–µ –º–∏—Ç—Ç—î–≤—ñ** - —Å–∏—Å—Ç–µ–º–∞ Android –æ–±–º–µ–∂—É—î —á–∞—Å—Ç–æ—Ç—É –æ–Ω–æ–≤–ª–µ–Ω—å –≤—ñ–¥–∂–µ—Ç—ñ–≤
2. **Glance –æ–±–º–µ–∂–µ–Ω–Ω—è** - –Ω–µ –≤—Å—ñ Compose –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ
3. **–ù–µ–º–∞—î –∞–Ω—ñ–º–∞—Ü—ñ–π** - RemoteViews –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î —Å–∫–ª–∞–¥–Ω—ñ –∞–Ω—ñ–º–∞—Ü—ñ—ó
4. **–ë–∞—Ç–∞—Ä–µ—è** - —á–∞—Å—Ç—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ –±–∞—Ç–∞—Ä–µ—é

## –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –í—ñ–¥–∂–µ—Ç –Ω–µ –∑'—è–≤–ª—è—î—Ç—å—Å—è
1. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ `AndroidManifest.xml` - receiver –º–∞—î –±—É—Ç–∏ –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–∏–π
2. –û—á–∏—Å—Ç–∏—Ç–∏ –∫–µ—à: Build ‚Üí Clean Project ‚Üí Rebuild Project
3. –ü–µ—Ä–µ–≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –¥–æ–¥–∞—Ç–æ–∫

### –í—ñ–¥–∂–µ—Ç –Ω–µ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è
1. –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø—Ä–∏—Å—Ç—Ä—ñ–π
2. –í–∏–¥–∞–ª–∏—Ç–∏ —Ç–∞ –¥–æ–¥–∞—Ç–∏ –≤—ñ–¥–∂–µ—Ç –∑–∞–Ω–æ–≤–æ
3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏: `adb logcat | grep Glance`

### –ü–æ–º–∏–ª–∫–∏ –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó
1. –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏ Gradle: File ‚Üí Sync Project with Gradle Files
2. Invalidate Caches: File ‚Üí Invalidate Caches / Restart

## –ü–æ–¥—è–∫–∏

–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ –∫–æ–¥—ñ –∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é **Grit** (https://github.com/shub39/Grit), —è–∫–∏–π –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î best practices –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Jetpack Glance –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ–¥–∂–µ—Ç—ñ–≤.
